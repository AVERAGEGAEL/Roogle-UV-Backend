<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Roogle UV Debug Proxy</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font: 16px sans-serif;
      padding: 20px;
    }
    iframe {
      width: 100%;
      height: 80vh;
      border: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Roogle UV Debug</h1>
  <div id="log"></div>

  <script>
    function log(msg, strong = false) {
      console.log(msg);
      const d = document.getElementById('log');
      d.innerHTML += (strong ? '<strong>' : '') + msg + (strong ? '</strong>' : '') + '<br>';
    }

    log('üèÅ Debug Starting‚Ä¶', true);
  </script>

  <!-- Load UV files from your GitHub fork -->
  <script src="https://averagegael.github.io/Ultraviolet-Core/uv.bundle.js"></script>
  <script src="https://averagegael.github.io/Ultraviolet-Core/uv.config.js"></script>
  <script src="https://averagegael.github.io/Ultraviolet-Core/uv.handler.js"></script>

  <script>
    window.addEventListener('load', async () => {
      log('‚úÖ Page fully loaded');

      const urlParams = new URLSearchParams(location.search);
      const targetUrl = urlParams.get('url');
      if (!targetUrl) {
        log('‚ùó Missing ?url parameter.');
        return;
      }

      log('üåê URL: ' + targetUrl);
      log('üß© ServiceWorker supported? ' + ('serviceWorker' in navigator));

      // Wait a moment for UV globals to load
      await new Promise(res => setTimeout(res, 300));

      if (typeof Ultraviolet === 'undefined') {
        log('‚ùó Ultraviolet is not defined. Check if uv.bundle.js is loading correctly.');
        return;
      } else {
        log('‚úÖ Ultraviolet defined');
      }

      if (typeof __uv$config === 'undefined') {
        log('‚ùó __uv$config is not defined. Check uv.config.js');
        return;
      } else {
        log('‚úÖ __uv$config loaded');
        log('üîß Config prefix: ' + __uv$config.prefix);
        log('üîß Config SW: ' + __uv$config.sw);
      }

      try {
        const reg = await navigator.serviceWorker.register(__uv$config.sw, {
          scope: __uv$config.prefix,
        });
        log('‚úÖ ServiceWorker registered: ' + reg.scope);
      } catch (e) {
        log('‚ùó ServiceWorker registration failed: ' + e.message);
        return;
      }

      let uv;
      try {
        uv = new Ultraviolet(__uv$config);
        log('‚úÖ Ultraviolet instance created');
      } catch (e) {
        log('‚ùó Ultraviolet constructor failed: ' + e.message);
        return;
      }

      if (typeof uv.init !== 'function') {
        log('‚ùó uv.init function is missing ‚Äî the UV build may be broken.');
        return;
      } else {
        log('‚úÖ uv.init() function found');
      }

      try {
        await uv.init();
        log('‚úÖ uv.init() completed');
      } catch (e) {
        log('‚ùó uv.init() failed: ' + e.message);
        return;
      }

      const iframe = document.createElement('iframe');
      iframe.style = 'width:100%;height:80vh;border:none;';
      document.body.appendChild(iframe);
      log('‚úÖ Iframe added to page');

      try {
        uv.navigate(iframe, targetUrl);
        log('‚úÖ Navigation started to: ' + targetUrl);
      } catch (e) {
        log('‚ùó uv.navigate() failed: ' + e.message);
      }
    });
  </script>
</body>
</html>
